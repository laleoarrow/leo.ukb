% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/diagnosis_icd_fo.R
\name{diagnosis_process_icd}
\alias{diagnosis_process_icd}
\title{Process UKB ICD data for survival analysis}
\usage{
diagnosis_process_icd(
  data,
  icd_code,
  icd = 10,
  censored = "2025-01-01",
  icd_rank = 1,
  baseline_date = "p53_i0",
  filter_NA = FALSE
)
}
\arguments{
\item{data}{A data.frame containing UKB baseline, censoring, ICD code and date columns.}

\item{icd_code}{A target ICD code prefix or a character vector of prefixes (e.g., "M10" or c("E10", "E11")).}

\item{icd}{ICD version, 10 or 9.}

\item{censored}{Censoring date ("YYYY-MM-DD").}

\item{icd_rank}{Rank of diagnosis occurrence to consider (1 = first occurrence, 2 = second occurrence, etc.).}

\item{baseline_date}{Baseline date column name (default "p53_i0").}

\item{filter_NA}{Logical, whether to filter out NA row. Default FALSE (Suitable for comorbidity check).}
}
\value{
A data.frame with eid, {icd_code}_status, {icd_code}_time.
}
\description{
Generate {icd_code}_status and {icd_code}_time from UKB ICD records.
}
\examples{
df_example <- data.frame(
  eid = 1:5,
  p53_i0 = as.Date(c("2006-01-01", "2007-06-01", "2005-03-15", "2004-10-30", "2008-05-10")),  # baseline
  p191 = as.Date(c("2020-01-01", "2019-12-31", "2021-06-30", "2022-07-01", "2023-09-10")),    # last follow-up
  p40000_i0 = as.Date(c(NA, NA, NA, "2021-06-01", NA)),                                       # death date (field 0)
  p40000_i1 = as.Date(c(NA, NA, NA, NA, NA)),                                                 # death date (field 1)
  p41270 = c("D261|E113|M102", "E113|M101", NA, "D261|M102|M103", "E113|M101|D261"),          # ICD10 codes
  p41280_a0 = as.Date(c("2010-05-01", "2011-07-20", NA, "2015-03-01", "2017-07-05")),         # 1st diagnosis date
  p41280_a1 = as.Date(c("2012-03-10", "2014-09-01", NA, "2016-06-01", "2018-08-10")),         # 2nd diagnosis date
  p41280_a2 = as.Date(c("2015-08-15", NA, NA, "2015-09-10", NA)),                             # 3rd diagnosis date
  p41280_a3 = as.Date(c(NA, NA, NA, NA, NA))                                                  # Additional diagnosis field for testing
)

# Prefix matching: D261 matches only D261 (icd_rank = 1)
diagnosis_process_icd(df_example, icd_code = "D261", icd = 10, icd_rank = 1)

# Prefix matching: M10 matches M101 / M102 (icd_rank = 1)
diagnosis_process_icd(df_example, icd_code = "M10", icd = 10, icd_rank = 1)

# Prefix matching: E113 matches E113 only (icd_rank = 1)
diagnosis_process_icd(df_example, icd_code = "E113", icd = 10, icd_rank = 1)

# Prefix matching: M10 matches M101 / M102 (icd_rank = 2)
diagnosis_process_icd(df_example, icd_code = "M10", icd = 10, icd_rank = 2)

# Multiple ICD codes: c("M10", "E113") - takes global earliest date among all matches
diagnosis_process_icd(df_example, icd_code = c("M10", "E113"), icd = 10, icd_rank = 1)
# Output columns: M10_E113_status, M10_E113_time
}
